<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
</head>
<body>

<script>
    // Notification.requestPermission().then((result) => {
    //     console.log(result);
    // });
    // displayNotification()
    // function displayNotification() {
    //     if(Notification.permission === "granted") {
    //         navigator.serviceWorker.getRegistration().then((reg) => {
    //             reg.showNotification("Notification created successfully!");
    //         })
    //     }
    // }
</script>
<script>
    if ('serviceWorker' in navigator && 'PushManager' in window) {
        console.log("here");

        if (Notification.permission !== 'granted') {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    subscribeForPush();
                } else {
                    console.warn('Push notifications permission denied');
                }
            });
        } else {
            subscribeForPush();
        }
    }
    function urlBase64ToUint8Array(base64String) {
        const padding = '='.repeat((4 - base64String.length % 4) % 4);
        const base64 = (base64String + padding)
            .replace(/-/g, '+')
            .replace(/_/g, '/');

        const rawData = atob(base64);
        return new Uint8Array([...rawData].map(c => c.charCodeAt(0)));
    }

    function subscribeForPush() {
        const vapidPublicKey = 'BHehFUGEHDZdnusscRlrBCKomV2GsjRaLGa3-ZJjUBtUVv4RDFLGex_T9V33QGi5Vfv1O6WHnsgJ-u9cclk0wD4'; // â† this is hardcoded or injected

        navigator.serviceWorker.ready.then(reg => {
            reg.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)
            }).then(subscription => {
                console.log("Subscribed!", subscription.toJSON());

                // Send to backend to store the subscription
                fetch("/save-subscription", {
                    method: "POST",
                    body: JSON.stringify(subscription),
                    headers: {
                        "Content-Type": "application/json"
                    }
                });
            });
        });
    }
</script>
</body>
</html>